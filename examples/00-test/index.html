<!DOCTYPE HTML>
<html>

<head>
	<!-- support for mobile touch devices -->
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

	<!-- twitter bootstrap CSS stylesheet - not required by cornerstoneTools -->
	<link href="../bootstrap.min.css" rel="stylesheet">

	<link href="../cornerstone.min.css" rel="stylesheet">

</head>

<body>
	<div class="container">
		<div class="page-header">
			<h1>
				Updated API Concept
			</h1>
			<a href="../index.html">Go back to the Examples page</a>
		</div>

		<br>

		<div class="row">
			<div class="col-xs-2">
				<ul class="list-group">
					<a id="lengthBtn" class="list-group-item">Mouse Length</a>
					<a id="angleBtn" class="list-group-item">Mouse Angle</a>
					<a id="wwwcBtn" class="list-group-item">Mouse WWWC</a>
				</ul>
				<br/>

				<ul class="list-group">
					<a id="lengthTouchBtn" class="list-group-item">Touch Length</a>
					<a id="angleTouchBtn" class="list-group-item">Touch Angle</a>
					<a id="wwwcTouchBtn" class="list-group-item">Touch WWWC</a>
				</ul>
				<br/>
			</div>
			<div class="col-xs-10">
				<div style="width:512px;height:512px;position:relative;display:inline-block;color:white;" oncontextmenu="return false" class='cornerstone-enabled-image'
				 unselectable='on' onselectstart='return false;' onmousedown='return false;'>
					<div id="dicomImage" style="width:512px;height:512px;top:0px;left:0px; position:absolute;">
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<h3>Functionality</h3>
			</div>
		</div>
</body>

<!-- include the hammer.fakemultitouch so we can test with a mouse -->
<script src="../touch-emulator.js"></script>
<script>TouchEmulator();</script>

<!-- include the hammer.js library for touch gestures-->
<script src="../hammer.min.js"></script>

<!-- include the cornerstone library -->
<script src="../cornerstone.min.js"></script>

<script src="../cornerstoneMath.min.js"></script>


<!-- include the cornerstone tools library -->
<script src="../../dist/cornerstoneTools.js"></script>
<script>window.cornerstoneTools || document.write('<script src="https://unpkg.com/cornerstone-tools">\x3C/script>')</script>

<!-- include special code for these examples which provides images -->
<script src="../exampleImageLoader.js"></script>

<script>
	const imageId = 'example://1';
	const element = document.getElementById('dicomImage');

	cornerstone.enable(element);

	// NEW
	const lengthMouseTool = new cornerstoneTools.lengthMouse();
	cornerstoneTools.addTool(element, lengthMouseTool)
	const lengthTouchTool = new cornerstoneTools.lengthTouch();
	cornerstoneTools.addTool(element, lengthTouchTool)
	//
	const angleMouseTool = new cornerstoneTools.angleMouse();
	cornerstoneTools.addTool(element, angleMouseTool)
	const angleTouchTool = new cornerstoneTools.angleTouch();
	cornerstoneTools.addTool(element, angleTouchTool)
	//
	const wwwcMouseTool = new cornerstoneTools.wwwcMouse();
	cornerstoneTools.addTool(element, wwwcMouseTool)
	const wwwcTouchTool = new cornerstoneTools.wwwcTouch();
	cornerstoneTools.addTool(element, wwwcTouchTool)

	// Default active tool
	cornerstoneTools.setToolActive(element, lengthMouseTool.name, { mouseButtonMask: 1 })

	// Todo: Marry these two?
	cornerstoneTools.mouseInput.enable(element);
	cornerstoneTools.mouseToolEventDispatcher.enable(element);
	//
	cornerstoneTools.touchInput.enable(element);
	cornerstoneTools.touchToolEventDispatcher.enable(element);
	// END NEW

	cornerstone.loadImage(imageId).then(function (image) {
		cornerstone.displayImage(element, image);
	});

	function setAllToolsPassive() {
		cornerstoneTools.store.state.tools.forEach((tool) => {
			cornerstoneTools.setToolPassive(element, tool.name)
		})
	}

	function activateMouseTool(toolName) {
		setAllToolsPassive();
		cornerstoneTools.setToolActive(element, toolName, { mouseButtonMask: 1 })
	}

	function activateTouchTool(toolName) {
		setAllToolsPassive();
		cornerstoneTools.setToolActive(element, toolName)
	}


	// Mouse
	document.getElementById('lengthBtn').addEventListener('click', (evt) => activateMouseTool(lengthMouseTool.name));
	document.getElementById('angleBtn').addEventListener('click', (evt) => activateMouseTool(angleMouseTool.name));
	document.getElementById('wwwcBtn').addEventListener('click', (evt) => activateMouseTool(wwwcMouseTool.name));

	// Touch Group
	document.getElementById('lengthTouchBtn').addEventListener('click', (evt) => activateTouchTool(lengthTouchTool.name));
	document.getElementById('wwwcTouchBtn').addEventListener('click', (evt) => activateTouchTool(wwwcTouchTool.name));
	document.getElementById('angleTouchBtn').addEventListener('click', (evt) => activateTouchTool(angleTouchTool.name));
</script>

</html>